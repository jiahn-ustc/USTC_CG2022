## 计算机图形学第三次作业报告

> PB19051035周佳豪

### 问题描述

​		使用poisson图像融合算法进行图像之间的融合，将图像中提取的对象合成另外一张图像，从而生成视觉上自然的新图像。同时需要实时拖动多边形区域得到结果，需要构造相应的稀疏矩阵以及进行矩阵分解。

### 算法说明

1. 使用`poly2mask()`函数构造包含提取对象的长方形`mask`，并对长方形中属于原图像的点进行标号（为了更快的找到稀疏矩阵A中-1的位置）

2. 构造稀疏矩阵A，根据散度公式可得$ b_{i,j}=-4f_{i,j}+f_{i+1,j}+f_{i,j+1}+f_{i-1,j}+f_{i,j-1} $进而构造系数矩阵A,然后调用`decomposition()`函数实现矩阵的分解

   >  值得注意的是目标图像边界点的邻居可能不属于目标区域，此时稀疏矩阵A的相应行应该去掉该邻居对应的-1项，这可能会导致出现以下方程 $-4f_{i,j}+f_{i+1,j}+f_{i,j+1}= b_{i,j}$,需要处理相应的$b_{i,j}$ ，即$b_{i,j}=-2I_{i,j}+I_{i+1,j}+I_{i,j+1}-f_{i-1,j}-f_{i,j-1}$,最终方程为$-4f_{i,j}+f_{i+1,j}+f_{i,j+1}+f_{i-1,j}+f_{i,j-1} = -2I_{i,j}+I_{i+1,j}+I_{i,j+1}$，仍是对应点的散度相等。

3. 创建矩阵b，一般地对于内部节点（邻居节点也为内部节点）$b_{i,j}=-4I_{i,j}+I_{i+1,j}+I_{i,j+1}+I_{i-1,j}+I_{i,j-1}$,对于其他靠近边界节点（部分邻居为外部节点），不妨设左邻居与上邻居为外部节点，此时$ b_{i,j}=-2I_{i,j}+I_{i+1,j}+I_{i,j+1}-f_{i-1,j}-f_{i,j-1} $

4. 根据得到的线性方程组$Ax=b$可解得$x$，即为目标图像各点的像素值，最后根据mask进行赋值即可。

### 实验结果

![image-20220315171657795](C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20220315171657795.png)

![image-20220315171733789](C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20220315171733789.png)

![image-20220315171807485](C:\Users\86130\AppData\Roaming\Typora\typora-user-images\image-20220315171807485.png)

### 结果分析

* 实验中可实时拖动`Background`图像中的多边形得到实时结果，得益于对矩阵A的分解。
* 融合的目标图像很好地与周围环境相容。



